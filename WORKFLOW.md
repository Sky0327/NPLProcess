# NPL 평가 시스템 웹 마이그레이션 워크플로우

## 1. 개요

본 문서는 Excel VBA 기반 NPL(부실채권) 평가 시스템을 웹 기반 시스템으로 마이그레이션하기 위한 전체 워크플로우를 정의합니다.

## 2. 시스템 아키텍처 개요

### 2.1 현재 시스템 (Legacy)
- **플랫폼**: Excel VBA (Smart_NPL.xlsm)
- **데이터 저장**: Excel 워크시트
- **외부 연동**: Python 스크립트 (main.exe) 실행
- **사용자 인터페이스**: Excel 리본 메뉴

### 2.2 목표 시스템 (Web)
- **플랫폼**: 웹 애플리케이션
- **데이터 저장**: 데이터베이스 (RDBMS)
- **외부 연동**: RESTful API 또는 직접 연동
- **사용자 인터페이스**: 웹 브라우저 기반 UI

## 3. 전체 워크플로우 개요

시스템은 **Smart_NPL1 탭**과 **Smart_NPL2 탭**으로 구분되어 있으며, 각 탭은 서로 다른 단계의 작업을 담당합니다.

### 3.1 전체 프로세스 흐름도

```
┌─────────────────────────────────────────────────────────────┐
│                    Smart_NPL1 탭 (데이터 수집 및 처리)        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [파일 초기화]                                              │
│       ↓                                                     │
│  ┌──────────────┐  ┌──────────────┐                        │
│  │보고서명 설정  │  │ID/PW/API 설정│                        │
│  └──────┬───────┘  └──────┬───────┘                        │
│         └────────┬─────────┘                               │
│                  ↓                                          │
│         [등기목록 불러오기 & Input 불러오기]                 │
│                  ↓                                          │
│  ┌──────────────────────────────────────────────┐          │
│  │         병렬 데이터 조회 프로세스              │          │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐    │          │
│  │  │등기조회  │  │공시지가  │  │법원경매  │    │          │
│  │  │         │  │조회      │  │조회      │    │          │
│  │  └────┬─────┘  └────┬─────┘  └────┬─────┘    │          │
│  │       │             │             │          │          │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐    │          │
│  │  │인포케어  │  │인포케어  │  │실거래가  │    │          │
│  │  │통계      │  │통합      │  │조회_국토 │    │          │
│  │  └────┬─────┘  └────┬─────┘  └────┬─────┘    │          │
│  │       │             │             │          │          │
│  │  ┌──────────┐       │       ┌──────────┐    │          │
│  │  │실거래가  │       │       │          │    │          │
│  │  │조회_밸류│       │       │          │    │          │
│  │  │맵        │       │       │          │    │          │
│  │  └────┬─────┘       │       └────┬─────┘    │          │
│  └───────┼─────────────┼─────────────┼──────────┘          │
│          │             │             │                     │
│          ↓             ↓             ↓                     │
│  ┌──────────────────────────────────────────────┐          │
│  │         중간 처리 프로세스                     │          │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐    │          │
│  │  │KB시세    │  │인포케어  │  │거리계산  │    │          │
│  │  │조회      │  │사례      │  │_국토     │    │          │
│  │  │(등기+공시│  │(통합→사례│  │(실거래→  │    │          │
│  │  │지가)     │  │)         │  │거리)     │    │          │
│  │  └────┬─────┘  └────┬─────┘  └────┬─────┘    │          │
│  │       │             │             │          │          │
│  │  ┌──────────┐       │       ┌──────────┐    │          │
│  │  │거리계산  │       │       │          │    │          │
│  │  │_밸류맵   │       │       │          │    │          │
│  │  │(밸류맵→  │       │       │          │    │          │
│  │  │거리)     │       │       │          │    │          │
│  │  └────┬─────┘       │       └────┬─────┘    │          │
│  └───────┼─────────────┼─────────────┼──────────┘          │
│          │             │             │                     │
│          ↓             ↓             ↓                     │
│  ┌──────────────────────────────────────────────┐          │
│  │         리포트 생성                          │          │
│  │  [2-1] 담보물정보  [2-2]감정평가  [3]경매정보│          │
│  │  [5-1] 낙찰통계    [5-2] 낙찰사례            │          │
│  │  [6-1] 실거래사례_국토  [6-1] 실거래사례_밸류│          │
│  └──────────────────────────────────────────────┘          │
│                                                             │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│                    Smart_NPL2 탭 (최종 처리 및 내보내기)     │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [0]물건지  [1]채권현황                                     │
│       ↓                                                     │
│  [등본PDF 파일명 변환]                                      │
│       ↓                                                     │
│  [xlsx로 내보내기]                                          │
│       ↓                                                     │
│  [파일 초기화] (피드백 루프)                                │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 초기화 및 설정 워크플로우

**단계**: Smart_NPL1 탭 - 시작 단계

```
[파일 초기화]
    ↓
┌──────────────┐  ┌──────────────┐
│보고서명 설정  │  │ID/PW/API 설정 │
└──────┬───────┘  └──────┬───────┘
       └────────┬─────────┘
                ↓
    [등기목록 불러오기 & Input 불러오기]
```

**Input:**
- 없음 (시작 단계)

**처리:**
1. 파일 초기화 (InitializeFile)
   - 시스템 기본 설정 초기화
   - 필요한 시트 생성 확인
2. 보고서명 설정 (SetReportName)
   - 생성할 리포트의 이름 설정
   - Source 시트에 저장
3. ID/PW/API 설정
   - 프로젝트 ID 설정
   - 외부 시스템 API 인증 정보 설정
   - 입력 폴더 경로 설정

**Output:**
- 초기화된 시스템 환경
- 설정된 보고서명
- 설정된 API 인증 정보
- 등기목록 및 Input 데이터 로드 완료

**다음 단계:**
- 등기목록 및 Input 데이터가 준비되면 병렬 데이터 조회 프로세스 시작

### 3.3 병렬 데이터 조회 워크플로우 (Smart_NPL1 탭)

**단계**: Smart_NPL1 탭 - 데이터 수집 단계

다음 조회 프로세스들은 **등기목록 불러오기 & Input 불러오기** 완료 후 **병렬로 실행** 가능합니다.

#### 3.3.1 등기조회

**Input:**
- 등기목록 및 Input 데이터 (등기번호, 주소)

**처리:**
1. Input_등기조회 시트 생성
   - Input 시트에서 데이터 복사
2. 외부 시스템 조회
   - Python 스크립트 실행 (register_inquiry)
   - 등기 상세정보 조회 API 호출

**Output:**
- Output_등기조회 시트
- 등기 상세정보 (권리사항, 전세권, 근저당권 등)

**다음 단계:**
- Output_등기조회 → KB시세조회 (Input으로 사용)
- Output_등기조회 → [2-1] 담보물정보 리포트 생성 (Input으로 사용)

---

#### 3.3.2 공시지가조회

**Input:**
- 등기목록 및 Input 데이터 (등기번호, 주소)

**처리:**
1. Input_공시지가 시트 생성
   - Input 시트에서 데이터 복사
2. 외부 시스템 조회
   - Python 스크립트 실행 (posting_price)
   - 공시지가 조회 API 호출

**Output:**
- Output_공시지가 시트
- 공시지가 정보 (지목, 면적, 공시지가 등)
- Output_공시지가(전체) 시트

**다음 단계:**
- Output_공시지가 → KB시세조회 (Input으로 사용)
- Output_공시지가 → [2-1] 담보물정보 리포트 생성 (Input으로 사용)

---

#### 3.3.3 법원경매조회

**Input:**
- 등기목록 및 Input 데이터 (등기번호, 주소)

**처리:**
1. Input_법원경매 시트 생성
   - Input 시트에서 데이터 복사
2. 외부 시스템 조회
   - Python 스크립트 실행 (court_auction)
   - 법원 경매 정보 조회 API 호출

**Output:**
- Output_법원경매 시트
- 경매 정보 (법원, 사건번호, 경매일자, 경매가격 등)

**다음 단계:**
- Output_법원경매 → [3] 경매정보 리포트 생성 (Input으로 사용)

---

#### 3.3.4 인포케어 통계

**Input:**
- 등기목록 및 Input 데이터 (등기번호, 주소)

**처리:**
1. Input_정보분석 시트 생성
   - Input 시트에서 데이터 복사
   - "전체" 텍스트 검사 (허용 안 함)
2. 외부 시스템 조회
   - Python 스크립트 실행 (infocare_analysis)
   - 정보 분석 조회 API 호출

**Output:**
- Output_정보분석 시트
- 정보 분석 결과 (통계 데이터)

**다음 단계:**
- Output_정보분석 → [5-1] 낙찰통계 리포트 생성 (Input으로 사용)

---

#### 3.3.5 인포케어 통합

**Input:**
- 등기목록 및 Input 데이터 (등기번호, 주소)

**처리:**
1. Input_정보통합 시트 생성
   - Input 시트에서 데이터 복사
2. 외부 시스템 조회
   - Python 스크립트 실행 (infocare_integrated)
   - 정보 통합 조회 API 호출

**Output:**
- Output_정보통합 시트
- 정보 통합 결과

**다음 단계:**
- Output_정보통합 → 인포케어 사례 (Input으로 사용)

---

#### 3.3.6 실거래가조회_국토

**Input:**
- 등기목록 및 Input 데이터 (등기번호, 주소)

**처리:**
1. Input_부동산가격 시트 생성
   - Input 시트에서 데이터 복사
   - 데이터 매핑 및 전처리 (MatchAndExtract2, MatchAndExtract3, MarkV 등)
2. 외부 시스템 조회
   - Python 스크립트 실행 (gookto_real_price)
   - 국토부 실거래가 조회 API 호출

**Output:**
- Output_부동산가격_실거래가 시트
- 실거래가 정보 (거래일자, 거래가격, 면적 등)

**다음 단계:**
- Output_부동산가격_실거래가 → 거리계산_국토 (Input으로 사용)

---

#### 3.3.7 실거래가조회_밸류맵

**Input:**
- 등기목록 및 Input 데이터 (등기번호, 주소)

**처리:**
1. Input_부동산가격 시트 생성 (실거래가조회_국토와 동일한 Input 사용)
2. 외부 시스템 조회
   - Python 스크립트 실행 (valuemap)
   - Valuemap 조회 API 호출

**Output:**
- Output_부동산가격_Valuemap 시트
- Valuemap 가격 정보

**다음 단계:**
- Output_부동산가격_Valuemap → 거리계산_밸류맵 (Input으로 사용)

### 3.4 중간 처리 워크플로우 (Smart_NPL1 탭)

**단계**: Smart_NPL1 탭 - 데이터 가공 단계

병렬 조회 프로세스의 결과를 기반으로 추가 처리를 수행합니다.

#### 3.4.1 KB시세조회

**Input:**
- Output_등기조회 (등기 상세정보)
- Output_공시지가(전체) (공시지가 정보)

**처리:**
1. Input_KB부동산 시트 생성
   - Input 시트에서 인덱스 복사
   - Output_공시지가(전체) 시트에서 데이터 복사
2. 외부 시스템 조회
   - Python 스크립트 실행 (kb_info)
   - KB 부동산 정보 조회 API 호출

**Output:**
- Output_KB부동산 시트
- KB 부동산 정보 (가격, 면적, 용도 등)

**다음 단계:**
- Output_KB부동산 → [2-1] 담보물정보 리포트 생성 (Input으로 사용)
- Output_KB부동산 → [2-2] 감정평가 리포트 생성 (Input으로 사용)

---

#### 3.4.2 인포케어 사례

**Input:**
- Output_정보통합 (인포케어 통합 결과)

**처리:**
1. Input_정보상세 시트 생성
   - Output_정보통합 데이터 기반
2. 외부 시스템 조회
   - Python 스크립트 실행 (infocare_case)
   - 정보 케이스 조회 API 호출

**Output:**
- Output_정보상세 시트
- 정보 케이스 결과

**다음 단계:**
- Output_정보상세 → [5-2] 낙찰사례 리포트 생성 (Input으로 사용)

---

#### 3.4.3 거리계산_국토

**Input:**
- Output_부동산가격_실거래가 (국토부 실거래가 정보)

**처리:**
1. 거리 계산 로직 실행
   - Python 스크립트 실행 (gookto_calculate_distance)
   - 거리 계산 알고리즘 적용

**Output:**
- Output_거리_실거래가 시트
- 거리 정보 추가된 실거래가 데이터

**다음 단계:**
- Output_거리_실거래가 → [6-1] 실거래사례_국토 리포트 생성 (Input으로 사용)

---

#### 3.4.4 거리계산_밸류맵

**Input:**
- Output_부동산가격_Valuemap (Valuemap 가격 정보)

**처리:**
1. 거리 계산 로직 실행
   - Python 스크립트 실행 (valuemap_calculate_distance)
   - 거리 계산 알고리즘 적용

**Output:**
- Output_거리_Valuemap 시트
- 거리 정보 추가된 Valuemap 데이터

**다음 단계:**
- Output_거리_Valuemap → [6-1] 실거래사례_밸류맵 리포트 생성 (Input으로 사용)

### 3.5 리포트 생성 워크플로우 (Smart_NPL1 탭)

**단계**: Smart_NPL1 탭 - 리포트 생성 단계

수집 및 가공된 데이터를 기반으로 구조화된 리포트를 생성합니다.

#### 3.5.1 담보 Mapping 및 [2-1] 담보물정보 리포트

**Input:**
- Input 시트 (기본 데이터)
- Output_등기조회 (등기 상세정보)
- Output_KB부동산 (KB 부동산 정보)

**처리:**
1. 담보 Mapping 생성
   - Input 시트에서 U열(용도(지역구분)) 기준 정렬
   - AB열에 담보_Mapping 생성 (담보-1, 담보-2, ...)
2. 필수 시트 확인
   - Input 시트
   - Output_등기조회 시트
   - Output_공시지가 시트
3. 담보 매핑 검증
   - CheckCollateralMapping: 담보 매핑 검증
4. 리포트 시트 생성
   - Tpl_Report_2-1 템플릿 복사
   - 담보물건현황_table_생성: 테이블 생성 및 데이터 매핑

**Output:**
- Input 시트에 담보_Mapping 컬럼 추가
- [2-1] 담보물정보 리포트 시트

---

#### 3.5.2 [2-2] 감정평가 리포트

**Input:**
- Output_KB부동산 (KB 부동산 정보)

**처리:**
1. Output_KB부동산 시트 확인
2. 리포트 시트 생성
   - Tpl_Report_KB부동산 템플릿 복사
   - UpdateTableKB: KB 정보 테이블 업데이트
     - ReportKB: Output_KB부동산 데이터를 리포트로 복사
     - TemplateKB: 템플릿 적용
     - Hyperlink_sheet: 하이퍼링크 생성
3. 컬럼 너비 조정

**Output:**
- [2-2] 감정평가 리포트 시트

---

#### 3.5.3 [3] 경매정보 리포트

**Input:**
- Output_법원경매 (법원 경매 정보)

**처리:**
1. Output_법원경매 시트 확인
2. 리포트 시트 생성
   - Tpl_Report_법원경매 템플릿 복사
   - UpdateTableAuction: 경매 정보 테이블 업데이트
     - CopyUniqueIDsToReport: 고유 ID 복사
     - UpdateCourtAndCaseNumber: 법원 및 사건번호 업데이트
     - UpdateExistingRowsInReport: 기존 행 업데이트
     - UpdateAuctionStartDate: 경매 시작일 업데이트
     - UpdateAuctionEndDate: 경매 종료일 업데이트
     - UpdateFirstAuctionConclusion: 첫 경매 결론 업데이트
     - UpdateAuctionFinalPrice: 경매 최종가격 업데이트
     - UpdateAuctionFinalDate: 경매 최종일자 업데이트
     - UpdateAuctionFinalResult: 경매 최종결과 업데이트
     - UpdateFirstAuctionPrice: 첫 경매 가격 업데이트
     - UpdateFirstAuctionDate: 첫 경매 일자 업데이트
     - ProcessAuctionData: 경매 데이터 처리
     - Hyperlink_sheet: 하이퍼링크 생성
3. 컬럼 너비 조정

**Output:**
- [3] 경매정보 리포트 시트

---

#### 3.5.4 [5-1] 낙찰통계 리포트

**Input:**
- Output_정보분석 (인포케어 통계 결과)

**처리:**
1. Output_정보분석 시트 확인
2. 데이터 변환
   - transformAnalysis: 분석 데이터 변환
   - dataAnalysis 시트 생성
3. 데이터 요약
   - ShowAuctionPeriodForCounts: 경매 기간별 카운트 표시
   - HighlightRowsByPeriod: 기간별 행 하이라이트
   - summaryAnalysis: 분석 요약
   - summaryAnalysis 시트 생성
4. 리포트 시트 생성
   - Tpl_Report_정보분석 템플릿 복사
   - CopyToTableAnalysis: 테이블 분석에 복사
   - CreateTempAnalysis: 임시 분석 생성
   - ImportImagesFromFolder: 폴더에서 이미지 가져오기
   - Hyperlink_sheet: 하이퍼링크 생성
5. 컬럼 너비 조정

**Output:**
- [5-1] 낙찰통계 리포트 시트
- dataAnalysis 시트 (숨김)
- summaryAnalysis 시트 (숨김)

---

#### 3.5.5 [5-2] 낙찰사례 리포트

**Input:**
- Output_정보상세 (인포케어 사례 결과)

**처리:**
1. Output_정보상세 시트 확인
2. 리포트 시트 생성
   - Tpl_Report_정보상세 템플릿 복사
   - UpdateTableCases: 케이스 테이블 업데이트
     - Output_정보상세 데이터를 리포트로 복사
     - 데이터 변환 및 계산
3. 컬럼 너비 조정

**Output:**
- [5-2] 낙찰사례 리포트 시트

---

#### 3.5.6 [6-1] 실거래사례_국토 리포트

**Input:**
- Output_거리_실거래가 (거리 계산된 국토부 실거래가)

**처리:**
1. Output_거리_실거래가 시트 확인
2. 검증 마킹 확인
   - CheckForVInColumn: U열에 V 마킹 확인
3. 리포트 시트 생성
   - 부동산가격_1: 리포트 생성
4. 데이터 포맷팅

**Output:**
- [6-1] 실거래사례_국토 리포트 시트

---

#### 3.5.7 [6-1] 실거래사례_밸류맵 리포트

**Input:**
- Output_거리_Valuemap (거리 계산된 Valuemap 데이터)

**처리:**
1. Output_거리_Valuemap 시트 확인
2. 검증 마킹 확인
   - CheckForVInColumn: O열에 V 마킹 확인
3. 리포트 시트 생성
   - 부동산가격_2: 리포트 생성
4. 데이터 포맷팅

**Output:**
- [6-1] 실거래사례_밸류맵 리포트 시트

---

### 3.6 Smart_NPL2 탭 워크플로우 (최종 처리 및 내보내기)

**단계**: Smart_NPL2 탭 - 최종 리포트 생성 및 내보내기

Smart_NPL1 탭에서 생성된 리포트들을 최종 정리하고 내보냅니다.

#### 3.6.1 [0] 물건지 리포트

**Input:**
- Input 시트 (기본 데이터)

**처리:**
1. Input 시트 확인
2. 리포트 시트 생성
   - Tpl_Report_0 템플릿 복사
   - 리포트 0 시트 생성
3. 데이터 처리
   - removeApo: 아포스트로피 제거
   - 데이터 매핑 및 변환

**Output:**
- [0] 물건지 리포트 시트

---

#### 3.6.2 [1] 채권현황 리포트

**Input:**
- 없음 (독립적으로 생성)

**처리:**
1. 리포트 시트 생성
   - Tpl_Report_1 템플릿 복사
   - 리포트 1 시트 생성
2. 데이터 처리
   - ImportSellList: 매각 리스트 가져오기

**Output:**
- [1] 채권현황 리포트 시트

---

#### 3.6.3 등본PDF 파일명 변환

**Input:**
- Output_기본정보 시트

**처리:**
1. Output_기본정보 시트 확인
2. PDF 이름 생성
   - GetToBePDFName: 변경할 PDF 이름 생성
3. 파일 이름 변경
   - RenamePDFFiles: PDF 파일 이름 변경 실행

**Output:**
- PDF 파일 이름 변경 완료

---

#### 3.6.4 xlsx로 내보내기

**Input:**
- 모든 생성된 리포트 시트들
- [0] 물건지
- [1] 채권현황
- [2-1] 담보물정보
- [2-2] 감정평가
- [3] 경매정보
- [5-1] 낙찰통계
- [5-2] 낙찰사례
- [6-1] 실거래사례_국토
- [6-1] 실거래사례_밸류맵

**처리:**
1. 모든 리포트 시트 확인
2. Excel 변환
   - ConvertToXlsx: XLSM을 XLSX로 변환
   - 모든 리포트 시트 포함

**Output:**
- XLSX 파일 생성 (최종 리포트)

**피드백 루프:**
- xlsx로 내보내기 완료 후 → 파일 초기화 (새로운 프로젝트 시작 가능)

---

## 4. 전체 데이터 흐름 및 Input/Output 관계

### 4.1 전체 데이터 흐름도

```
┌─────────────────────────────────────────────────────────────┐
│                    초기화 및 설정                             │
│  파일 초기화 → 보고서명 설정 / ID/PW/API 설정                 │
│                    ↓                                         │
│            등기목록 불러오기 & Input 불러오기                 │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│              병렬 데이터 조회 (병렬 실행 가능)                │
│                                                             │
│  Input 데이터 → [등기조회] → Output_등기조회                 │
│  Input 데이터 → [공시지가조회] → Output_공시지가              │
│  Input 데이터 → [법원경매조회] → Output_법원경매             │
│  Input 데이터 → [인포케어 통계] → Output_정보분석            │
│  Input 데이터 → [인포케어 통합] → Output_정보통합            │
│  Input 데이터 → [실거래가조회_국토] → Output_부동산가격_실거래가│
│  Input 데이터 → [실거래가조회_밸류맵] → Output_부동산가격_Valuemap│
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│              중간 처리 (의존성 기반 순차 실행)                 │
│                                                             │
│  Output_등기조회 + Output_공시지가                          │
│        ↓                                                     │
│  [KB시세조회] → Output_KB부동산                             │
│                                                             │
│  Output_정보통합                                            │
│        ↓                                                     │
│  [인포케어 사례] → Output_정보상세                          │
│                                                             │
│  Output_부동산가격_실거래가                                 │
│        ↓                                                     │
│  [거리계산_국토] → Output_거리_실거래가                     │
│                                                             │
│  Output_부동산가격_Valuemap                                 │
│        ↓                                                     │
│  [거리계산_밸류맵] → Output_거리_Valuemap                   │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│              리포트 생성 (의존성 기반 순차 실행)               │
│                                                             │
│  Input + Output_등기조회 + Output_KB부동산                   │
│        ↓                                                     │
│  [담보Mapping] → [2-1] 담보물정보                           │
│                                                             │
│  Output_KB부동산                                            │
│        ↓                                                     │
│  [2-2] 감정평가                                             │
│                                                             │
│  Output_법원경매                                            │
│        ↓                                                     │
│  [3] 경매정보                                               │
│                                                             │
│  Output_정보분석                                            │
│        ↓                                                     │
│  [5-1] 낙찰통계                                             │
│                                                             │
│  Output_정보상세                                            │
│        ↓                                                     │
│  [5-2] 낙찰사례                                             │
│                                                             │
│  Output_거리_실거래가                                       │
│        ↓                                                     │
│  [6-1] 실거래사례_국토                                       │
│                                                             │
│  Output_거리_Valuemap                                       │
│        ↓                                                     │
│  [6-1] 실거래사례_밸류맵                                     │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│              최종 처리 및 내보내기                            │
│                                                             │
│  Input → [0] 물건지                                         │
│  (독립) → [1] 채권현황                                      │
│  Output_기본정보 → 등본PDF 파일명 변환                       │
│  모든 리포트 → xlsx로 내보내기 → 파일 초기화 (피드백 루프)   │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 Input/Output 관계 상세

#### 4.2.1 초기 단계
- **Input**: 없음 (시작)
- **Output**: 초기화된 시스템, 설정 정보, 등기목록 및 Input 데이터

#### 4.2.2 병렬 조회 단계
| 프로세스 | Input | Output | 다음 단계에서 사용 |
|---------|-------|--------|------------------|
| 등기조회 | 등기목록 & Input | Output_등기조회 | KB시세조회, [2-1] 담보물정보 |
| 공시지가조회 | 등기목록 & Input | Output_공시지가 | KB시세조회, [2-1] 담보물정보 |
| 법원경매조회 | 등기목록 & Input | Output_법원경매 | [3] 경매정보 |
| 인포케어 통계 | 등기목록 & Input | Output_정보분석 | [5-1] 낙찰통계 |
| 인포케어 통합 | 등기목록 & Input | Output_정보통합 | 인포케어 사례 |
| 실거래가조회_국토 | 등기목록 & Input | Output_부동산가격_실거래가 | 거리계산_국토 |
| 실거래가조회_밸류맵 | 등기목록 & Input | Output_부동산가격_Valuemap | 거리계산_밸류맵 |

#### 4.2.3 중간 처리 단계
| 프로세스 | Input | Output | 다음 단계에서 사용 |
|---------|-------|--------|------------------|
| KB시세조회 | Output_등기조회 + Output_공시지가 | Output_KB부동산 | [2-1] 담보물정보, [2-2] 감정평가 |
| 인포케어 사례 | Output_정보통합 | Output_정보상세 | [5-2] 낙찰사례 |
| 거리계산_국토 | Output_부동산가격_실거래가 | Output_거리_실거래가 | [6-1] 실거래사례_국토 |
| 거리계산_밸류맵 | Output_부동산가격_Valuemap | Output_거리_Valuemap | [6-1] 실거래사례_밸류맵 |

#### 4.2.4 리포트 생성 단계
| 리포트 | Input | Output |
|--------|-------|--------|
| [2-1] 담보물정보 | Input + Output_등기조회 + Output_KB부동산 | 리포트 시트 |
| [2-2] 감정평가 | Output_KB부동산 | 리포트 시트 |
| [3] 경매정보 | Output_법원경매 | 리포트 시트 |
| [5-1] 낙찰통계 | Output_정보분석 | 리포트 시트 |
| [5-2] 낙찰사례 | Output_정보상세 | 리포트 시트 |
| [6-1] 실거래사례_국토 | Output_거리_실거래가 | 리포트 시트 |
| [6-1] 실거래사례_밸류맵 | Output_거리_Valuemap | 리포트 시트 |

#### 4.2.5 최종 처리 단계
| 프로세스 | Input | Output |
|---------|-------|--------|
| [0] 물건지 | Input | 리포트 시트 |
| [1] 채권현황 | 없음 (독립) | 리포트 시트 |
| 등본PDF 파일명 변환 | Output_기본정보 | PDF 파일명 변경 완료 |
| xlsx로 내보내기 | 모든 리포트 시트 | XLSX 파일 |

### 4.3 실행 순서 및 의존성

#### 4.3.1 필수 순서 (의존성 기반)
1. **초기화 및 설정** (필수)
2. **등기목록 불러오기 & Input 불러오기** (필수)
3. **병렬 조회 프로세스** (병렬 실행 가능)
4. **중간 처리** (의존성 기반 순차 실행)
   - KB시세조회는 등기조회와 공시지가조회 완료 후 실행
   - 인포케어 사례는 인포케어 통합 완료 후 실행
   - 거리계산은 각각의 실거래가조회 완료 후 실행
5. **리포트 생성** (의존성 기반 순차 실행)
   - 각 리포트는 해당 Output 데이터 준비 후 실행
6. **최종 처리 및 내보내기** (모든 리포트 생성 후 실행)

#### 4.3.2 병렬 실행 가능 구간
- **병렬 조회 프로세스**: 등기조회, 공시지가조회, 법원경매조회, 인포케어 통계, 인포케어 통합, 실거래가조회_국토, 실거래가조회_밸류맵은 서로 독립적이므로 병렬 실행 가능

#### 4.3.3 순차 실행 필수 구간
- **중간 처리**: 이전 단계의 Output이 다음 단계의 Input이 되므로 순차 실행 필요
- **리포트 생성**: 각 리포트는 해당 Output 데이터가 준비되어야 생성 가능

## 5. 외부 시스템 연동

### 5.1 Python 스크립트 실행
- **현재 방식**: main.exe 실행 (Shell 명령)
- **웹 마이그레이션**: 
  - Python 스크립트를 RESTful API로 변환
  - 또는 백엔드 서비스로 통합

### 5.2 외부 API 연동
- 등기 정보 조회 API
- 공시지가 조회 API
- 국토부 실거래가 API
- Valuemap API
- KB 부동산 정보 API
- 법원 경매 정보 API
- 정보 분석 API (Infocare)

## 6. 사용자 인증 및 권한 관리

### 6.1 인증 워크플로우
```
[시스템 접근]
    ↓
[PwC 인증 확인]
    - IsPwC(): PwC 도메인 확인
    - GetUserMSMail(): 사용자 이메일 확인
    ↓
[사용자 정보 기록]
    - AddOpenTime(): 접속 시간 기록
    - TimeToGoogle(): 사용 이력 전송
    ↓
[시스템 사용 허용]
```

### 6.2 사용 이력 관리
- 접속 시간 기록
- 사용 시간 추적
- Google Forms로 사용 이력 전송 (암호화)

## 7. 에러 처리 및 검증

### 7.1 필수 시트 검증
- CheckRequiredSheet(): 필수 시트 존재 확인
- 시트가 없으면 에러 메시지 표시 및 프로세스 중단

### 7.2 데이터 검증
- CheckCollateralMapping(): 담보 매핑 검증
- CheckForVInColumn(): 검증 마킹 확인
- 데이터 형식 검증

### 7.3 에러 처리
- Try-Catch 블록으로 에러 처리
- 사용자 친화적 에러 메시지 표시
- 로그 기록

## 8. 성능 최적화

### 8.1 Excel 성능 최적화
- SpeedUp/SpeedDown: 화면 업데이트 비활성화
- 대량 데이터 처리 시 배치 처리

### 8.2 웹 마이그레이션 시 고려사항
- 비동기 처리 (Async/Await)
- 백그라운드 작업 큐
- 캐싱 전략
- 데이터베이스 인덱싱

## 9. 마이그레이션 우선순위

### Phase 1: 핵심 기능
1. 사용자 인증 및 권한 관리
2. 등기 기본정보 조회
3. Input/Output 데이터 관리
4. 기본 리포트 생성

### Phase 2: 주요 기능
1. 등기 상세조회
2. 공시지가 조회
3. 부동산 가격 정보 조회
4. KB 부동산 정보 조회
5. 법원 경매 정보 조회

### Phase 3: 고급 기능
1. 정보 분석 (분석, 통합, 케이스)
2. 고급 리포트 생성
3. PDF 파일 관리
4. 데이터 내보내기/가져오기

### Phase 4: 최적화 및 개선
1. 성능 최적화
2. UI/UX 개선
3. 추가 기능 개발
4. 모니터링 및 로깅

## 10. 기술 스택 제안

### 10.1 프론트엔드
- React 또는 Vue.js
- TypeScript
- Material-UI 또는 Ant Design

### 10.2 백엔드
- Node.js (Express) 또는 Python (Django/FastAPI)
- RESTful API
- WebSocket (실시간 업데이트용)

### 10.3 데이터베이스
- PostgreSQL 또는 MySQL
- Redis (캐싱)

### 10.4 인프라
- Docker 컨테이너화
- 클라우드 배포 (AWS, Azure, GCP)
- CI/CD 파이프라인

## 11. 참고사항

- 모든 Excel 시트는 데이터베이스 테이블로 변환 필요
- Excel 템플릿은 웹 리포트 템플릿으로 변환 필요
- Python 스크립트는 백엔드 서비스로 통합 필요
- 파일 시스템 기반 저장소는 데이터베이스로 마이그레이션 필요


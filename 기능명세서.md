# NPL 평가 시스템 기능명세서

## 1. 문서 개요

### 1.1 목적
본 문서는 Excel VBA 기반 NPL(부실채권) 평가 시스템의 모든 기능을 상세히 명세하여 웹 기반 시스템으로의 마이그레이션을 위한 기준을 제공합니다.

### 1.2 범위
- 모든 VBA 모듈의 기능 분석
- 입력/출력 데이터 구조
- 외부 시스템 연동 명세
- 리포트 생성 로직

### 1.3 참고 파일
- LegacyCode 폴더의 모든 .bas 파일
- Smart_NPL최신.xlsm
- NPL 평가 Report 요건정의.xlsx

## 2. 시스템 개요

### 2.1 시스템 목적
부실채권(NPL) 평가를 위한 부동산 정보 수집, 분석, 리포트 생성 자동화 시스템

### 2.2 주요 사용자
- PwC 컨설턴트
- 부동산 평가 전문가
- 금융기관 관계자

## 3. 기능 명세

### 3.1 초기화 및 설정 기능

#### 3.1.1 파일 초기화 (InitializeFile)
**기능 ID**: FUNC-001  
**설명**: 시스템 사용을 위한 초기 파일 설정

**입력**:
- 없음

**처리**:
- 시스템 기본 설정 초기화
- 필요한 시트 생성 확인

**출력**:
- 초기화 완료 메시지

**관련 모듈**: Call_Main.bas

---

#### 3.1.2 리포트명 설정 (SetReportName)
**기능 ID**: FUNC-002  
**설명**: 생성할 리포트의 이름 설정

**입력**:
- 리포트명 (문자열)

**처리**:
- 리포트명을 Source 시트에 저장
- 이후 생성되는 모든 리포트에 리포트명 적용

**출력**:
- 설정 완료 메시지

**관련 모듈**: Call_Main.bas

---

#### 3.1.3 ID 설정 (SetID)
**기능 ID**: FUNC-003  
**설명**: 프로젝트 ID 설정

**입력**:
- 프로젝트 ID (문자열)

**처리**:
- 프로젝트 ID를 Source 시트에 저장

**출력**:
- 설정 완료 메시지

**관련 모듈**: Call_Main.bas

---

#### 3.1.4 입력 폴더 경로 설정 (get_registry_info_basic_selectfolder)
**기능 ID**: FUNC-004  
**설명**: 외부 시스템 조회 결과 파일이 저장될 폴더 경로 설정

**입력**:
- 폴더 경로 (사용자 선택)

**처리**:
- 폴더 선택 다이얼로그 표시
- 선택한 경로를 Source 시트에 저장

**출력**:
- 경로 저장 완료

**관련 모듈**: Module_HJ.bas

---

### 3.2 등기 정보 조회 기능

#### 3.2.1 등기 기본정보 조회 (get_registry_basic_info)
**기능 ID**: FUNC-101  
**설명**: 등기번호를 기반으로 등기 기본정보 조회

**입력**:
- 등기번호 (Input 시트 또는 직접 입력)
- 주소

**처리**:
1. Input 시트 생성 (makeInputSheet_input)
2. 등기번호 및 주소 입력
3. Python 스크립트 실행 (Run_run_get_registry_basic_info)
   - main.exe 실행
   - get_registry_basic_info 스크립트 실행
4. 외부 등기 정보 조회 API 호출
5. 결과 데이터 수신 및 처리

**출력**:
- Output_기본정보 시트 생성
- 등기번호, 주소, 소유자 정보 등
- 데이터 포맷팅 (컬럼 너비, 색상, 폰트 등)

**데이터 구조**:
- 컬럼: 등기번호, 주소, 소유자, 면적 등

**관련 모듈**: 
- Call_Main.bas
- Module_HJ.bas
- Module_Output.bas
- exeRun.bas

---

#### 3.2.2 등기 상세조회 (register_inquiry)
**기능 ID**: FUNC-102  
**설명**: 등기번호를 기반으로 등기 상세정보 조회

**입력**:
- 등기번호 (Input 시트에서 복사)
- 주소

**처리**:
1. Input_등기조회 시트 생성 (makeInputSheet_등기조회)
2. Input 시트에서 데이터 복사 (set_input_2)
3. Python 스크립트 실행 (Run_run_register_inquiry)
   - main.exe 실행
   - register_inquiry 스크립트 실행
4. 외부 등기 상세정보 조회 API 호출
5. 결과 데이터 수신 및 처리

**출력**:
- Output_등기조회 시트 생성
- 등기 상세정보 (권리사항, 전세권, 근저당권 등)
- Output_등기조회(전체) 시트 생성 (전체 데이터)

**데이터 구조**:
- 컬럼: 등기번호, 주소, 권리자, 채권최고액, 설정일자 등

**관련 모듈**: 
- Call_Main.bas
- Module_HJ.bas
- Module_Output.bas

---

### 3.3 공시지가 조회 기능

#### 3.3.1 공시지가 조회 (posting_price)
**기능 ID**: FUNC-201  
**설명**: 부동산의 공시지가 정보 조회

**입력**:
- 등기번호 (Input 시트에서 복사)
- 주소

**처리**:
1. Input_공시지가 시트 생성 (makeInputSheet_공시지가)
2. Input 시트에서 데이터 복사 (set_input_3)
3. Python 스크립트 실행 (Run_run_posting_price)
   - main.exe 실행
   - posting_price 스크립트 실행
4. 외부 공시지가 조회 API 호출
5. 결과 데이터 수신 및 처리

**출력**:
- Output_공시지가 시트 생성
- 공시지가 정보 (지목, 면적, 공시지가 등)
- Output_공시지가(전체) 시트 생성

**데이터 구조**:
- 컬럼: 등기번호, 주소, 지목, 면적, 공시지가, 공시연도 등

**관련 모듈**: 
- Call_Main.bas
- Module_HJ.bas
- Module_Output.bas

---

### 3.4 부동산 가격 정보 조회 기능

#### 3.4.1 부동산 가격 Input 시트 생성 (set_input_4)
**기능 ID**: FUNC-301  
**설명**: 부동산 가격 정보 조회를 위한 Input 시트 생성 및 데이터 준비

**입력**:
- Input 시트 데이터

**처리**:
1. Input_부동산가격 시트 생성 (makeInputSheet_부동산가격)
2. Input 시트에서 데이터 복사 (set_input_4)
3. 데이터 매핑 및 전처리:
   - MatchAndExtract2: 데이터 매칭
   - MatchAndExtract3: 추가 데이터 추출
   - MarkV: 검증 마킹
   - SetValuesBasedOnKColumn: K열 기준 값 설정
   - DoubleLookupAndReturnValuesWithLoops: 이중 조회

**출력**:
- Input_부동산가격 시트 생성
- 전처리된 데이터

**관련 모듈**: 
- Call_Main.bas
- Module_HJ.bas
- Module_JM.bas

---

#### 3.4.2 레벨 업데이트 (level_update)
**기능 ID**: FUNC-302  
**설명**: 부동산 가격 Input 시트의 레벨 정보 업데이트

**입력**:
- Input_부동산가격 시트 데이터

**처리**:
1. Input_부동산가격 시트 확인
2. DoubleLookupAndReturnValuesWithLoops 실행
3. 레벨 정보 업데이트

**출력**:
- 업데이트 완료 메시지

**관련 모듈**: Call_Main.bas

---

#### 3.4.3 국토부 실거래가 조회 (gookto_real_price)
**기능 ID**: FUNC-303  
**설명**: 국토부 실거래가 정보 조회

**입력**:
- Input_부동산가격 시트 데이터

**처리**:
1. Input_부동산가격 시트 확인
2. Python 스크립트 실행 (Run_run_gookto_real_price)
   - main.exe 실행
   - gookto_real_price 스크립트 실행
3. 외부 국토부 실거래가 조회 API 호출
4. 결과 데이터 수신 및 처리

**출력**:
- Output_부동산가격_실거래가 시트 생성
- 실거래가 정보 (거래일자, 거래가격, 면적 등)
- 검증 컬럼 추가 (V 마킹)

**데이터 구조**:
- 컬럼: 등기번호, 주소, 거래일자, 거래가격, 면적, 검증 등

**관련 모듈**: 
- Call_Main.bas
- Module_Output.bas

---

#### 3.4.4 Valuemap 조회 (valuemap)
**기능 ID**: FUNC-304  
**설명**: Valuemap 부동산 가격 정보 조회

**입력**:
- Input_부동산가격 시트 데이터

**처리**:
1. Input_부동산가격 시트 확인
2. Python 스크립트 실행 (Run_run_valuemap)
   - main.exe 실행
   - valuemap 스크립트 실행
3. 외부 Valuemap 조회 API 호출
4. 결과 데이터 수신 및 처리

**출력**:
- Output_부동산가격_Valuemap 시트 생성
- Valuemap 가격 정보
- 검증 컬럼 추가 (V 마킹)

**데이터 구조**:
- 컬럼: 등기번호, 주소, 가격정보, 면적, 검증 등

**관련 모듈**: 
- Call_Main.bas
- Module_Output.bas

---

#### 3.4.5 거리 계산 - 실거래가 (gookto_calculate_distance)
**기능 ID**: FUNC-305  
**설명**: 실거래가 기준 거리 계산

**입력**:
- Output_부동산가격_실거래가 시트 데이터

**처리**:
1. Python 스크립트 실행 (Run_run_gookto_calculate_distance)
   - main.exe 실행
   - gookto_calculate_distance 스크립트 실행
2. 거리 계산 로직 실행
3. 결과 데이터 수신 및 처리

**출력**:
- Output_거리_실거래가 시트 생성
- 거리 정보 추가

**관련 모듈**: 
- Call_Main.bas
- Module_Output.bas

---

#### 3.4.6 거리 계산 - Valuemap (valuemap_calculate_distance)
**기능 ID**: FUNC-306  
**설명**: Valuemap 기준 거리 계산

**입력**:
- Output_부동산가격_Valuemap 시트 데이터

**처리**:
1. Python 스크립트 실행 (Run_run_valuemap_calculate_distance)
   - main.exe 실행
   - valuemap_calculate_distance 스크립트 실행
2. 거리 계산 로직 실행
3. 결과 데이터 수신 및 처리

**출력**:
- Output_거리_Valuemap 시트 생성
- 거리 정보 추가

**관련 모듈**: 
- Call_Main.bas
- Module_Output.bas

---

### 3.5 KB 부동산 정보 조회 기능

#### 3.5.1 KB 부동산 정보 Input 시트 생성 (writeInputKB)
**기능 ID**: FUNC-401  
**설명**: KB 부동산 정보 조회를 위한 Input 시트 생성

**입력**:
- Input 시트 데이터
- Output_공시지가(전체) 시트 데이터

**처리**:
1. Input_KB부동산 시트 생성 (makeInputSheetKB)
2. Input 시트에서 인덱스 복사 (copyIndexKB)
3. Output_공시지가(전체) 시트에서 데이터 복사 (copyKB)
4. 빈 행 삭제 (delKB)
5. 포맷팅 (formatKB)

**출력**:
- Input_KB부동산 시트 생성

**관련 모듈**: 
- Call_Main.bas
- Call_Haneul.bas

---

#### 3.5.2 KB 부동산 정보 조회 (kb_info)
**기능 ID**: FUNC-402  
**설명**: KB 부동산 정보 조회

**입력**:
- Input_KB부동산 시트 데이터

**처리**:
1. Input_KB부동산 시트 확인
2. Python 스크립트 실행 (run_kb_info)
   - main.exe 실행
   - kb_info 스크립트 실행
3. 외부 KB 부동산 정보 조회 API 호출
4. 결과 데이터 수신 및 처리

**출력**:
- Output_KB부동산 시트 생성
- KB 부동산 정보 (가격, 면적, 용도 등)

**데이터 구조**:
- 컬럼: 등기번호, 주소, KB가격, 면적, 용도, 건축년도 등

**관련 모듈**: 
- Call_Main.bas
- Call_Haneul.bas
- a1_kbInfoHaneul.bas
- Module_Output.bas

---

### 3.6 법원 경매 정보 조회 기능

#### 3.6.1 법원 경매 정보 Input 시트 생성 (writeInputCourt)
**기능 ID**: FUNC-501  
**설명**: 법원 경매 정보 조회를 위한 Input 시트 생성

**입력**:
- Input 시트 데이터

**처리**:
1. Input_법원경매 시트 생성 (makeInputSheetCourt)
2. Input 시트에서 인덱스 복사 (copyIndexCourt)
3. Input 시트에서 데이터 복사 (copyCourt)
4. 빈 행 삭제 (delCourt)
5. 포맷팅 (formatCourt)

**출력**:
- Input_법원경매 시트 생성

**관련 모듈**: 
- Call_Main.bas
- Call_Haneul.bas

---

#### 3.6.2 법원 경매 정보 조회 (court_auction)
**기능 ID**: FUNC-502  
**설명**: 법원 경매 정보 조회

**입력**:
- Input_법원경매 시트 데이터

**처리**:
1. Input_법원경매 시트 확인
2. Python 스크립트 실행 (run_court_auction)
   - main.exe 실행
   - court_auction 스크립트 실행
3. 외부 법원 경매 정보 조회 API 호출
4. 결과 데이터 수신 및 처리

**출력**:
- Output_법원경매 시트 생성
- 경매 정보 (법원, 사건번호, 경매일자, 경매가격 등)

**데이터 구조**:
- 컬럼: 등기번호, 주소, 법원, 사건번호, 경매시작일, 경매종료일, 경매가격 등

**관련 모듈**: 
- Call_Main.bas
- Call_Haneul.bas
- a2_courtAuction.bas
- Module_Output.bas

---

### 3.7 정보 분석 기능

#### 3.7.1 정보 분석 Input 시트 생성 (writeInputInfoAnalysis)
**기능 ID**: FUNC-601  
**설명**: 정보 분석 조회를 위한 Input 시트 생성

**입력**:
- Input 시트 데이터

**처리**:
1. Input_정보분석 시트 생성 (makeInputSheetInfoAnalysis)
2. Input 시트에서 데이터 복사

**출력**:
- Input_정보분석 시트 생성

**관련 모듈**: 
- Call_Main.bas
- Call_Haneul.bas

---

#### 3.7.2 정보 분석 조회 (infocare_analysis)
**기능 ID**: FUNC-602  
**설명**: 정보 분석 조회

**입력**:
- Input_정보분석 시트 데이터

**처리**:
1. Input_정보분석 시트 확인
2. "전체" 텍스트 검사 (허용 안 함)
3. Python 스크립트 실행 (run_infocare_analysis)
   - main.exe 실행
   - infocare_analysis 스크립트 실행
4. 외부 정보 분석 조회 API 호출
5. 결과 데이터 수신 및 처리

**출력**:
- Output_정보분석 시트 생성
- 정보 분석 결과

**데이터 구조**:
- 컬럼: 등기번호, 주소, 분석기간, 분석결과 등

**관련 모듈**: 
- Call_Main.bas
- a3_analysisHaneul.bas
- Module_Output.bas

---

#### 3.7.3 정보 통합 Input 시트 생성 (writeInputInfoAll)
**기능 ID**: FUNC-603  
**설명**: 정보 통합 조회를 위한 Input 시트 생성

**입력**:
- Input 시트 데이터

**처리**:
1. Input_정보통합 시트 생성 (makeInputSheetInfoAll)
2. Input 시트에서 데이터 복사

**출력**:
- Input_정보통합 시트 생성

**관련 모듈**: 
- Call_Main.bas
- Call_Haneul.bas

---

#### 3.7.4 정보 통합 조회 (infocare_integrated)
**기능 ID**: FUNC-604  
**설명**: 정보 통합 조회

**입력**:
- Input_정보통합 시트 데이터

**처리**:
1. Input_정보통합 시트 확인
2. Python 스크립트 실행 (run_infocare_integrated)
   - main.exe 실행
   - infocare_integrated 스크립트 실행
3. 외부 정보 통합 조회 API 호출
4. 결과 데이터 수신 및 처리

**출력**:
- Output_정보통합 시트 생성
- 정보 통합 결과

**관련 모듈**: 
- Call_Main.bas
- Module_Output.bas

---

#### 3.7.5 정보 상세 Input 시트 생성 (makeInputSheetInfoDetail)
**기능 ID**: FUNC-605  
**설명**: 정보 상세 조회를 위한 Input 시트 생성

**입력**:
- Input 시트 데이터

**처리**:
1. Input_정보상세 시트 생성 (makeInputSheetInfoDetail)
2. Input 시트에서 데이터 복사

**출력**:
- Input_정보상세 시트 생성

**관련 모듈**: 
- Call_Main.bas
- Call_Haneul.bas

---

#### 3.7.6 정보 케이스 조회 (infocare_case)
**기능 ID**: FUNC-606  
**설명**: 정보 케이스 조회

**입력**:
- Input_정보상세 시트 데이터

**처리**:
1. Input_정보상세 시트 확인
2. Python 스크립트 실행 (run_infocare_case)
   - main.exe 실행
   - infocare_case 스크립트 실행
3. 외부 정보 케이스 조회 API 호출
4. 결과 데이터 수신 및 처리

**출력**:
- Output_정보상세 시트 생성
- 정보 케이스 결과

**데이터 구조**:
- 컬럼: 등기번호, 주소, 케이스정보, 가격정보 등

**관련 모듈**: 
- Call_Main.bas
- a4_CasesHaneul.bas
- Module_Output.bas

---

### 3.8 리포트 생성 기능

#### 3.8.1 담보 Mapping (담보_Mapping)
**기능 ID**: FUNC-701  
**설명**: 담보물건에 대한 Mapping 생성

**입력**:
- Input 시트 데이터

**처리**:
1. Input 시트 확인
2. SortAndMapCollateral 실행
   - U열(용도(지역구분)) 기준 정렬
   - AB열에 담보_Mapping 생성 (담보-1, 담보-2, ...)

**출력**:
- Input 시트에 담보_Mapping 컬럼 추가

**관련 모듈**: 
- Call_Main2.bas
- Module_JM.bas

---

#### 3.8.2 리포트 0 - 기본 리포트
**기능 ID**: FUNC-702  
**설명**: 기본 리포트 생성

**입력**:
- Input 시트 데이터

**처리**:
1. Input 시트 확인
2. Tpl_Report_0 템플릿 복사하여 리포트 0 시트 생성
3. removeApo: 아포스트로피 제거
4. 데이터 매핑 및 변환

**출력**:
- 리포트 0 시트 생성

**관련 모듈**: Call_Main2.bas

---

#### 3.8.3 리포트 1 - 매각 리스트
**기능 ID**: FUNC-703  
**설명**: 매각 리스트 리포트 생성

**입력**:
- 없음

**처리**:
1. Tpl_Report_1 템플릿 복사하여 리포트 1 시트 생성
2. ImportSellList: 매각 리스트 가져오기

**출력**:
- 리포트 1 시트 생성

**관련 모듈**: Call_Main2.bas

---

#### 3.8.4 리포트 2-1 - 담보물건 현황
**기능 ID**: FUNC-704  
**설명**: 담보물건 현황 리포트 생성

**입력**:
- Input 시트
- Output_등기조회 시트
- Output_공시지가 시트

**처리**:
1. 필수 시트 확인
2. CheckCollateralMapping: 담보 매핑 검증
3. Tpl_Report_2-1 템플릿 복사하여 리포트 2-1 시트 생성
4. 담보물건현황_table_생성: 테이블 생성 및 데이터 매핑

**출력**:
- 리포트 2-1 시트 생성

**관련 모듈**: Call_Main2.bas

---

#### 3.8.5 리포트 2-2 - KB 부동산 정보
**기능 ID**: FUNC-705  
**설명**: KB 부동산 정보 리포트 생성

**입력**:
- Output_KB부동산 시트

**처리**:
1. Output_KB부동산 시트 확인
2. Tpl_Report_KB부동산 템플릿 복사하여 리포트 2-2 시트 생성
3. UpdateTableKB: KB 정보 테이블 업데이트
   - ReportKB: Output_KB부동산 데이터를 리포트로 복사
   - TemplateKB: 템플릿 적용
   - Hyperlink_sheet: 하이퍼링크 생성
4. 컬럼 너비 조정

**출력**:
- 리포트 2-2 시트 생성

**관련 모듈**: 
- Call_Main2.bas
- a1_kbInfoHaneul.bas

---

#### 3.8.6 리포트 3 - 법원 경매 정보
**기능 ID**: FUNC-706  
**설명**: 법원 경매 정보 리포트 생성

**입력**:
- Output_법원경매 시트

**처리**:
1. Output_법원경매 시트 확인
2. Tpl_Report_법원경매 템플릿 복사하여 리포트 3 시트 생성
3. UpdateTableAuction: 경매 정보 테이블 업데이트
   - CopyUniqueIDsToReport: 고유 ID 복사
   - UpdateCourtAndCaseNumber: 법원 및 사건번호 업데이트
   - UpdateExistingRowsInReport: 기존 행 업데이트
   - UpdateAuctionStartDate: 경매 시작일 업데이트
   - UpdateAuctionEndDate: 경매 종료일 업데이트
   - UpdateFirstAuctionConclusion: 첫 경매 결론 업데이트
   - UpdateAuctionFinalPrice: 경매 최종가격 업데이트
   - UpdateAuctionFinalDate: 경매 최종일자 업데이트
   - UpdateAuctionFinalResult: 경매 최종결과 업데이트
   - UpdateFirstAuctionPrice: 첫 경매 가격 업데이트
   - UpdateFirstAuctionDate: 첫 경매 일자 업데이트
   - ProcessAuctionData: 경매 데이터 처리
   - Hyperlink_sheet: 하이퍼링크 생성
4. 컬럼 너비 조정

**출력**:
- 리포트 3 시트 생성

**관련 모듈**: 
- Call_Main2.bas
- a2_courtAuction.bas

---

#### 3.8.7 리포트 5-1 - 정보 분석
**기능 ID**: FUNC-707  
**설명**: 정보 분석 리포트 생성

**입력**:
- Output_정보분석 시트

**처리**:
1. Output_정보분석 시트 확인
2. 데이터 변환:
   - transformAnalysis: 분석 데이터 변환
   - dataAnalysis 시트 생성
3. 데이터 요약:
   - ShowAuctionPeriodForCounts: 경매 기간별 카운트 표시
   - HighlightRowsByPeriod: 기간별 행 하이라이트
   - summaryAnalysis: 분석 요약
   - summaryAnalysis 시트 생성
4. Tpl_Report_정보분석 템플릿 복사하여 리포트 5-1 시트 생성
5. CopyToTableAnalysis: 테이블 분석에 복사
6. CreateTempAnalysis: 임시 분석 생성
7. ImportImagesFromFolder: 폴더에서 이미지 가져오기
8. Hyperlink_sheet: 하이퍼링크 생성
9. 컬럼 너비 조정

**출력**:
- 리포트 5-1 시트 생성
- dataAnalysis 시트 (숨김)
- summaryAnalysis 시트 (숨김)

**관련 모듈**: 
- Call_Main2.bas
- a3_analysisHaneul.bas

---

#### 3.8.8 리포트 5-2 - 케이스 정보
**기능 ID**: FUNC-708  
**설명**: 케이스 정보 리포트 생성

**입력**:
- Output_정보상세 시트

**처리**:
1. Output_정보상세 시트 확인
2. Tpl_Report_정보상세 템플릿 복사하여 리포트 5-2 시트 생성
3. UpdateTableCases: 케이스 테이블 업데이트
   - Output_정보상세 데이터를 리포트로 복사
   - 데이터 변환 및 계산
4. 컬럼 너비 조정

**출력**:
- 리포트 5-2 시트 생성

**관련 모듈**: 
- Call_Main2.bas
- a4_CasesHaneul.bas

---

#### 3.8.9 리포트 6-1 - 부동산 가격 정보 (실거래가)
**기능 ID**: FUNC-709  
**설명**: 부동산 가격 정보 리포트 생성 (실거래가 기준)

**입력**:
- Output_거리_실거래가 시트

**처리**:
1. Output_거리_실거래가 시트 확인
2. CheckForVInColumn: U열에 V 마킹 확인
3. 부동산가격_1: 리포트 생성
4. 데이터 포맷팅

**출력**:
- 리포트 6-1 시트 생성

**관련 모듈**: Call_Main2.bas

---

#### 3.8.10 리포트 6-2 - 부동산 가격 정보 (Valuemap)
**기능 ID**: FUNC-710  
**설명**: 부동산 가격 정보 리포트 생성 (Valuemap 기준)

**입력**:
- Output_거리_Valuemap 시트

**처리**:
1. Output_거리_Valuemap 시트 확인
2. CheckForVInColumn: O열에 V 마킹 확인
3. 부동산가격_2: 리포트 생성
4. 데이터 포맷팅

**출력**:
- 리포트 6-2 시트 생성

**관련 모듈**: Call_Main2.bas

---

### 3.9 유틸리티 기능

#### 3.9.1 PDF 파일 이름 변경
**기능 ID**: FUNC-801  
**설명**: PDF 파일 이름 변경

**입력**:
- Output_기본정보 시트

**처리**:
1. Output_기본정보 시트 확인
2. GetToBePDFName: 변경할 PDF 이름 생성
3. RenamePDFFiles: PDF 파일 이름 변경 실행

**출력**:
- PDF 파일 이름 변경 완료

**관련 모듈**: Call_Main2.bas

---

#### 3.9.2 Excel 변환 (XLSX)
**기능 ID**: FUNC-802  
**설명**: XLSM 파일을 XLSX 파일로 변환

**입력**:
- 현재 XLSM 파일

**처리**:
1. ConvertToXlsx 실행
2. XLSM을 XLSX로 변환

**출력**:
- XLSX 파일 생성

**관련 모듈**: Call_Main2.bas

---

### 3.10 사용자 인증 및 관리 기능

#### 3.10.1 사용자 인증 (IsPwC)
**기능 ID**: FUNC-901  
**설명**: PwC 사용자 인증 확인

**입력**:
- 사용자 도메인 정보

**처리**:
1. Environ("Userdnsdomain") 확인
2. "PWC" 문자열 포함 여부 확인

**출력**:
- 인증 성공/실패

**관련 모듈**: PwC.bas

---

#### 3.10.2 사용 이력 기록 (TimeToGoogle)
**기능 ID**: FUNC-902  
**설명**: 사용 이력을 Google Forms로 전송

**입력**:
- 사용자 정보
- 사용 시간
- 파일 경로

**처리**:
1. 사용자 정보 수집
2. 접속 시간, 종료 시간, 사용 시간 계산
3. 데이터 암호화 (Encrypt_form)
4. Google Forms로 POST 요청 전송

**출력**:
- Google Forms에 데이터 전송 완료

**관련 모듈**: PwC.bas

---

#### 3.10.3 접속 시간 기록 (AddOpenTime)
**기능 ID**: FUNC-903  
**설명**: 사용자 접속 시간 기록

**입력**:
- MAC 주소
- 사용자 이메일

**처리**:
1. GetMACAddress: MAC 주소 획득
2. UserMaster 테이블에서 사용자 확인
3. 접속 시간 기록

**출력**:
- 접속 시간 기록 완료

**관련 모듈**: PwC.bas

---

## 4. 데이터 구조

### 4.1 Input 시트 구조
- **등기번호**: 등기번호
- **주소**: 부동산 주소
- **용도(지역구분)**: 부동산 용도
- **담보_Mapping**: 담보 매핑 정보

### 4.2 Output 시트 구조 (공통)
- **등기번호**: 등기번호
- **주소**: 부동산 주소
- **조회 결과 데이터**: 각 기능별 조회 결과

### 4.3 리포트 시트 구조
- **템플릿 기반**: 각 리포트는 Tpl_Report_* 템플릿 기반
- **테이블 구조**: ListObject를 사용한 구조화된 테이블
- **하이퍼링크**: 관련 시트로의 하이퍼링크

## 5. 외부 시스템 연동

### 5.1 Python 스크립트 실행
- **실행 방식**: main.exe를 통한 스크립트 실행
- **스크립트 목록**:
  - get_registry_basic_info
  - register_inquiry
  - posting_price
  - gookto_real_price
  - valuemap
  - gookto_calculate_distance
  - valuemap_calculate_distance
  - kb_info
  - court_auction
  - infocare_analysis
  - infocare_integrated
  - infocare_case

### 5.2 외부 API 연동
- 등기 정보 조회 API
- 공시지가 조회 API
- 국토부 실거래가 API
- Valuemap API
- KB 부동산 정보 API
- 법원 경매 정보 API
- 정보 분석 API (Infocare)

## 6. 에러 처리

### 6.1 필수 시트 검증
- CheckRequiredSheet(): 필수 시트 존재 확인
- 시트가 없으면 에러 메시지 표시 및 프로세스 중단

### 6.2 데이터 검증
- CheckCollateralMapping(): 담보 매핑 검증
- CheckForVInColumn(): 검증 마킹 확인
- 데이터 형식 검증

### 6.3 에러 처리
- Try-Catch 블록으로 에러 처리
- 사용자 친화적 에러 메시지 표시
- 로그 기록

## 7. 성능 최적화

### 7.1 Excel 성능 최적화
- SpeedUp/SpeedDown: 화면 업데이트 비활성화
- 대량 데이터 처리 시 배치 처리

### 7.2 웹 마이그레이션 시 고려사항
- 비동기 처리 (Async/Await)
- 백그라운드 작업 큐
- 캐싱 전략
- 데이터베이스 인덱싱

## 8. 보안

### 8.1 사용자 인증
- PwC 도메인 기반 인증
- 사용자 이메일 확인

### 8.2 데이터 암호화
- Google Forms 전송 시 데이터 암호화 (AES-128)
- Base64 인코딩

## 9. 마이그레이션 고려사항

### 9.1 데이터베이스 설계
- Excel 시트를 데이터베이스 테이블로 변환
- 관계형 데이터베이스 설계
- 인덱싱 전략

### 9.2 API 설계
- RESTful API 설계
- Python 스크립트를 API로 변환
- 외부 시스템 연동 API

### 9.3 UI/UX 설계
- 웹 기반 사용자 인터페이스
- 반응형 디자인
- 사용자 경험 개선

### 9.4 리포트 생성
- Excel 템플릿을 웹 리포트 템플릿으로 변환
- PDF 생성 기능
- Excel 내보내기 기능

